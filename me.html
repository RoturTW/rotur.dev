<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Account - Rotur</title>
  <style>
    body {
      font-family: 'Poppins', Arial, sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    .account-layout {
      display: flex;
      width: 100vw;
      min-height: 100vh;
      background: #f5f7fa;
    }
    .sidebar {
      width: 280px;
      background: #fff;
      border-right: 1px solid #e1e5e9;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      padding: 24px 0 0 0;
      min-height: 100vh;
      box-shadow: 2px 0 8px rgba(0,0,0,0.03);
    }
    .sidebar-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 0 24px 20px 24px;
      width: 100%;
      border-bottom: 1px solid #f1f3f4;
      margin-bottom: 20px;
    }
    .sidebar-avatar {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      background: #f1f3f4;
      display: inline-block;
      object-fit: cover;
      background-size: cover;
      border: 2px solid #e8f0fe;
    }
    .sidebar-name {
      font-weight: 600;
      font-size: 16px;
      color: #1a1a1a;
    }
    .sidebar-system {
      margin-bottom: 12px;
      font-size: 13px;
      color: #5f6368;
      font-weight: 500;
      letter-spacing: 0.02em;
      padding: 0 24px 16px 24px;
    }
    .sidebar-currency {
      background: linear-gradient(135deg, #1a73e8, #4285f4);
      color: white;
      padding: 12px 20px;
      margin: 0 16px 20px 16px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      text-align: center;
      box-shadow: 0 2px 8px rgba(66,133,244,0.2);
      border: 1px solid rgba(255,255,255,0.1);
    }
    .sidebar-section {
      width: 100%;
      margin-bottom: 24px;
    }
    .sidebar-section-title {
      padding: 0 24px;
      font-size: 12px;
      font-weight: 600;
      color: #5f6368;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 8px;
    }
    .friends-list {
      max-height: 200px;
      overflow-y: auto;
    }
    .friend-item, .friend-request {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 24px;
      border-left: 3px solid transparent;
      transition: all 0.2s;
    }
    .friend-item:hover, .friend-request:hover {
      background: #f8f9fa;
      border-left-color: #1a73e8;
    }
    .friend-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #e8f0fe;
      background-size: cover;
      background-position: center;
      border: 2px solid #e8f0fe;
    }
    .friend-name {
      font-weight: 500;
      color: #333;
      font-size: 14px;
      flex: 1;
    }
    .friend-status {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #34a853;
    }
    .friend-request {
      border-left-color: #fbbc04;
    }
    .friend-request .friend-name {
      color: #ea4335;
    }
    .accept-btn {
      background: #34a853;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 11px;
      cursor: pointer;
      margin-left: 4px;
    }
    .sidebar-nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
      width: 100%;
    }
    .sidebar-nav li {
      padding: 14px 24px;
      color: #5f6368;
      font-size: 15px;
      cursor: pointer;
      border-radius: 0;
      margin: 0 8px 2px 8px;
      transition: all 0.2s;
      user-select: none;
      font-weight: 500;
      border-left: 3px solid transparent;
    }
    .sidebar-nav li.active {
      background: #e8f0fe;
      color: #1a73e8;
      border-left-color: #1a73e8;
      font-weight: 600;
    }
    .sidebar-nav li:hover {
      background: #f8f9fa;
      color: #1a73e8;
    }
    .main-area {
      flex: 1;
      padding: 32px 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      max-width: 800px;
      margin: 0 auto;
    }
    .main-card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      padding: 32px;
      max-width: 100%;
      width: 100%;
      margin-bottom: 24px;
      border: 1px solid #e1e5e9;
    }
    .main-header {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 1px solid #f1f3f4;
    }
    .main-avatar {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: #f1f3f4;
      display: inline-block;
      object-fit: cover;
      background-size: cover;
      border: 2px solid #e8f0fe;
    }
    .main-system {
      font-size: 14px;
      color: #5f6368;
      margin-top: 4px;
      font-weight: 500;
    }
    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 4px;
    }
    .form-group {
      margin-bottom: 20px;
      text-align: left;
      flex: 1;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }
    input, textarea, select {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e1e5e9;
      border-radius: 12px;
      font-size: 15px;
      font-family: inherit;
      background: #fafbfc;
      color: #202124;
      box-sizing: border-box;
      margin-bottom: 4px;
      transition: all 0.2s;
    }
    input:focus, textarea:focus, select:focus {
      border-color: #1a73e8;
      outline: none;
      box-shadow: 0 0 0 4px rgba(26, 115, 232, 0.1);
      background: #fff;
    }
    input[type="checkbox"] {
      width: auto;
      margin-right: 8px;
    }
    input[readonly], textarea[readonly] {
      background: #f1f3f4;
      color: #5f6368;
      cursor: not-allowed;
      border-color: #e8eaed;
    }
    .upload-area {
      border: 2px dashed #e1e5e9;
      border-radius: 12px;
      padding: 24px;
      text-align: center;
      background: #fafbfc;
      transition: all 0.2s;
      cursor: pointer;
      margin-bottom: 12px;
    }
    .upload-area:hover {
      border-color: #1a73e8;
      background: #f8f9ff;
    }
    .upload-area.dragover {
      border-color: #1a73e8;
      background: #e8f0fe;
    }
    .upload-icon {
      font-size: 32px;
      color: #5f6368;
      margin-bottom: 8px;
    }
    .upload-text {
      color: #5f6368;
      font-size: 14px;
    }
    .pfp-preview, .banner-preview {
      display: block;
      margin: 0 auto 12px auto;
      border-radius: 50%;
      width: 80px;
      height: 80px;
      object-fit: cover;
      background: #eee;
      border: 1.5px solid #e1e5e9;
    }
    .banner-preview {
      border-radius: 12px;
      width: 100%;
      height: 80px;
      object-fit: cover;
      margin-bottom: 12px;
      border: 1.5px solid #e1e5e9;
    }
    .btn-primary {
      background: linear-gradient(90deg,#1a73e8 0%,#4285f4 100%);
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 16px 32px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      margin-top: 16px;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(66,133,244,0.2);
      min-height: 52px;
    }
    .btn-primary:hover {
      background: linear-gradient(90deg,#1557b0 0%,#1a73e8 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(66,133,244,0.3);
    }
    .error-message {
      color: #ea4335;
      text-align: center;
      margin: 10px 0 0 0;
      font-size: 15px;
    }
    .success-message {
      color: #34a853;
      text-align: center;
      margin: 10px 0 0 0;
      font-size: 15px;
    }
    .token-warning {
      color: #ea4335;
      font-size: 14px;
      margin-bottom: 18px;
      text-align: center;
    }
    .tab-content {
      display: none;
      animation: fadeIn 0.3s;
    }
    .tab-content.active {
      display: block;
    }
    .section-block {
      margin-bottom: 28px;
      padding-bottom: 20px;
      border-bottom: 1px solid #f1f3f4;
    }
    .section-block:last-child {
      border-bottom: none;
      margin-bottom: 24px;
    }
    .section-title {
      font-size: 18px;
      font-weight: 700;
      color: #1a73e8;
      margin-bottom: 16px;
      margin-top: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .privacy-public-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 12px;
      margin-top: 16px;
    }
    .privacy-public-item {
      background: #e8f0fe;
      color: #1a73e8;
      font-size: 14px;
      border-radius: 12px;
      padding: 16px 20px;
      font-weight: 600;
      letter-spacing: 0.01em;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
      border: 1px solid #c3d3f7;
      outline: none;
      transition: all 0.2s;
      text-align: center;
    }
    .privacy-public-item:hover {
      background: #d2e3fc;
      transform: translateY(-1px);
    }
    .data-usage-section {
      background: linear-gradient(135deg, #f8f9fa, #e8f0fe);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid #e1e5e9;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    .data-usage-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .data-usage-title {
      font-size: 18px;
      font-weight: 700;
      color: #1a73e8;
    }
    .data-usage-amount {
      font-size: 14px;
      color: #5f6368;
      font-weight: 600;
    }
    .progress-bar {
      width: 100%;
      height: 12px;
      background: #e8eaed;
      border-radius: 6px;
      overflow: hidden;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #34a853, #1a73e8);
      border-radius: 6px;
      transition: width 0.3s ease;
    }
    .profile-card {
      background: #fff;
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      margin-bottom: 24px;
    }
    .profile-header {
      display: flex;
      align-items: center;
      gap: 24px;
      margin-bottom: 32px;
      padding-bottom: 24px;
      border-bottom: 1px solid #e1e5e9;
    }
    .profile-avatar-large {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: #eee;
      background-size: cover;
      background-position: center;
      border: 4px solid #e8f0fe;
      box-shadow: 0 4px 16px rgba(26,115,232,0.15);
    }
    .profile-info {
      flex: 1;
    }
    .profile-name {
      font-size: 24px;
      font-weight: 700;
      color: #1a1a1a;
      margin: 0 0 8px 0;
    }
    .profile-username {
      font-size: 16px;
      color: #5f6368;
      margin: 0 0 12px 0;
    }
    .profile-stats {
      display: flex;
      gap: 24px;
    }
    .stat-item {
      text-align: center;
    }
    .stat-number {
      font-size: 18px;
      font-weight: 700;
      color: #1a73e8;
    }
    .stat-label {
      font-size: 12px;
      color: #5f6368;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .profile-section {
      margin-bottom: 28px;
      padding-bottom: 20px;
      border-bottom: 1px solid #f1f3f4;
    }
    .profile-section:last-child {
      border-bottom: none;
      margin-bottom: 24px;
    }
    .section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }
    .section-icon {
      width: 36px;
      height: 36px;
      background: #e8f0fe;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      border: 1px solid #c3d3f7;
    }
    .section-title {
      font-size: 18px;
      font-weight: 700;
      color: #1a73e8;
      margin: 0;
    }
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .form-grid.single {
      grid-template-columns: 1fr;
    }
    .enhanced-field {
      position: relative;
      margin-bottom: 20px;
    }
    .enhanced-field label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }
    .enhanced-field input,
    .enhanced-field textarea {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e1e5e9;
      border-radius: 12px;
      font-size: 15px;
      font-family: inherit;
      background: #fafbfc;
      color: #202124;
      box-sizing: border-box;
      transition: all 0.2s;
    }
    .enhanced-field input:focus,
    .enhanced-field textarea:focus {
      border-color: #1a73e8;
      outline: none;
      box-shadow: 0 0 0 4px rgba(26, 115, 232, 0.1);
      background: #fff;
    }
    .enhanced-field input[readonly],
    .enhanced-field textarea[readonly] {
      background: #f1f3f4;
      color: #5f6368;
      cursor: not-allowed;
      border-color: #e8eaed;
    }
    .upload-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 28px;
    }
    .upload-card {
      background: #f8f9fa;
      border: 2px dashed #e1e5e9;
      border-radius: 16px;
      padding: 32px 24px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      min-height: 160px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .upload-card:hover {
      border-color: #1a73e8;
      background: #f8f9ff;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(26,115,232,0.1);
    }
    .upload-card.has-image {
      border-color: #34a853;
      border-style: solid;
      background: #f1f8e9;
    }
    .upload-preview {
      width: 80px;
      height: 80px;
      border-radius: 12px;
      margin: 0 auto 16px;
      object-fit: cover;
      background: #e8eaed;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .upload-preview.avatar {
      border-radius: 50%;
    }
    .upload-icon {
      font-size: 32px;
      color: #5f6368;
      margin-bottom: 12px;
    }
    .upload-text {
      color: #5f6368;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .transaction-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 18px 20px;
      background: #fafbfc;
      border-radius: 12px;
      margin-bottom: 12px;
      border: 1px solid #e1e5e9;
      transition: all 0.2s;
    }
    .transaction-item:hover {
      background: #f8f9ff;
      border-color: #1a73e8;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(26,115,232,0.1);
    }
    .transaction-icon {
      width: 44px;
      height: 44px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 700;
      flex-shrink: 0;
    }
    .transaction-icon.credit {
      background: #e8f5e8;
      color: #34a853;
      border: 1px solid #c8e6c9;
    }
    .transaction-icon.debit {
      background: #fce8e6;
      color: #ea4335;
      border: 1px solid #ffcdd2;
    }
    .transaction-details {
      flex: 1;
      min-width: 0;
    }
    .transaction-title {
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 4px;
      font-size: 15px;
    }
    .transaction-date {
      font-size: 13px;
      color: #5f6368;
      font-weight: 500;
    }
    .transaction-amount {
      font-weight: 700;
      font-size: 16px;
      flex-shrink: 0;
    }
    .transaction-amount.credit {
      color: #34a853;
    }
    .transaction-amount.debit {
      color: #ea4335;
    }
    .cost-indicator {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 12px;
      font-weight: 600;
      margin-top: 8px;
      text-align: center;
    }
    .friends-page-section {
      margin-bottom: 32px;
    }
    .friends-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    .friend-card {
      background: #fafbfc;
      border: 1px solid #e1e5e9;
      border-radius: 16px;
      padding: 24px 20px;
      text-align: center;
      transition: all 0.2s;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    }
    .friend-card:hover {
      background: #f8f9ff;
      border-color: #1a73e8;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(26,115,232,0.15);
    }
    .friend-card-avatar {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: #e8f0fe;
      background-size: cover;
      background-position: center;
      margin: 0 auto 16px;
      border: 3px solid #e8f0fe;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .friend-card-name {
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 8px;
      font-size: 15px;
    }
    .friend-card-status {
      font-size: 12px;
      color: #34a853;
      font-weight: 500;
    }
    .friend-request-card {
      border-color: #fbbc04;
      background: #fffbf0;
    }
    .friend-request-card:hover {
      background: #fff8e1;
      border-color: #f9a825;
    }
    .friend-request-card .friend-card-name {
      color: #ea4335;
    }
    .friend-request-card .friend-card-status {
      color: #f57c00;
    }
    .accept-friend-btn {
      background: #34a853;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 16px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 8px;
      transition: background 0.2s;
    }
    .accept-friend-btn:hover {
      background: #2d7d32;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @media (max-width: 900px) {
      .account-layout {
        flex-direction: column;
      }
      .sidebar {
        width: 100vw;
        min-height: auto;
        border-right: none;
        border-bottom: 1px solid #e1e5e9;
        flex-direction: row;
        align-items: center;
        padding: 16px 0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.03);
        overflow-x: auto;
      }
      .sidebar-header {
        padding: 0 16px;
        border-bottom: none;
        margin-bottom: 0;
        flex-shrink: 0;
      }
      .sidebar-system {
        display: none;
      }
      .sidebar-currency {
        margin: 0 12px;
        white-space: nowrap;
        flex-shrink: 0;
      }
      .sidebar-nav {
        flex: 1;
        overflow-x: auto;
      }
      .sidebar-nav ul {
        display: flex;
        gap: 4px;
        overflow-x: auto;
        padding: 0 16px;
      }
      .sidebar-nav li {
        padding: 12px 16px;
        font-size: 14px;
        white-space: nowrap;
        margin: 0 2px;
        border-left: none;
        border-radius: 8px;
      }
      .main-area {
        padding: 16px 12px;
      }
      .main-card {
        padding: 24px 20px;
      }
      .main-header {
        gap: 12px;
        padding-bottom: 16px;
      }
      .main-avatar {
        width: 48px;
        height: 48px;
      }
      .form-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      .upload-section {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      .friends-grid {
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 12px;
      }
      .profile-header {
        flex-direction: column;
        text-align: center;
        gap: 16px;
      }
      .profile-stats {
        justify-content: center;
      }
    }
  </style>
</head>
<body>

  <div class="account-layout">
    <aside class="sidebar">
      <div class="sidebar-header">
        <span class="sidebar-avatar" id="sidebar-avatar"></span>
        <span class="sidebar-name" id="sidebar-name"></span>
      </div>
      <div class="sidebar-system" id="sidebar-system" style="color:#5f6368;font-size:13px;padding:0 24px 12px 24px;"></div>
      <div class="sidebar-currency" id="sidebar-currency">0 Credits</div>
      
      <nav class="sidebar-nav">
        <ul id="sidebar-tabs">
          <li class="active" data-tab="profile">Profile</li>
          <li data-tab="account">Account</li>
          <li data-tab="friends">Friends</li>
          <li data-tab="privacy">Privacy</li>
          <li data-tab="transactions">Transactions</li>
          <li data-tab="about">About</li>
        </ul>
      </nav>
    </aside>
    <main class="main-area">
      <div id="auth-container" class="main-card tab-content" data-tab="auth" style="display:none;">
        <div class="main-header">
          <span class="main-avatar" id="main-avatar"></span>
          <div>
            <h2 id="main-name">Account Authentication</h2>
          </div>
        </div>
        <div class="subtitle">Authenticate to view and edit your account.</div>
        <button class="btn-primary" id="auth-btn">Authenticate</button>
        <div class="token-warning" id="token-warning" style="display:none;">No token found. Please authenticate.</div>
      </div>
      
      <div id="profile-container" class="tab-content active" data-tab="profile">
        <div class="data-usage-section">
          <div class="data-usage-header">
            <div class="data-usage-title">Data Usage</div>
            <div class="data-usage-amount" id="data-usage-text">0 MB / 0 MB</div>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="data-usage-bar" style="width: 0%"></div>
          </div>
        </div>
        
        <div class="profile-card">
          <div class="profile-header">
            <div class="profile-avatar-large" id="profile-avatar-large"></div>
            <div class="profile-info">
              <h1 class="profile-name" id="profile-display-name">Your Name</h1>
              <p class="profile-username" id="profile-username-display">@username</p>
              <div class="profile-stats">
                <div class="stat-item">
                  <div class="stat-number" id="stat-friends">0</div>
                  <div class="stat-label">Friends</div>
                </div>
                <div class="stat-item">
                  <div class="stat-number" id="stat-credits">0</div>
                  <div class="stat-label">Credits</div>
                </div>
                <div class="stat-item">
                  <div class="stat-number" id="stat-system">None</div>
                  <div class="stat-label">System</div>
                </div>
              </div>
            </div>
          </div>
          
          <form id="profile-form">
            <div class="profile-section">
              <div class="section-header">
                <div class="section-icon">📷</div>
                <h3 class="section-title">Photos</h3>
              </div>
              <div class="upload-section">
                <div class="upload-card" onclick="document.getElementById('pfp-file').click()">
                  <img id="pfp-preview" class="upload-preview avatar" style="display:none;">
                  <div class="upload-icon">👤</div>
                  <div class="upload-text">Profile Picture</div>
                  <input type="file" id="pfp-file" accept="image/*" style="display:none;">
                </div>
                <div class="upload-card" onclick="document.getElementById('banner-file').click()">
                  <img id="banner-preview" class="upload-preview" style="display:none;">
                  <div class="upload-icon">🖼️</div>
                  <div class="upload-text">Banner Image</div>
                  <div class="cost-indicator">💰 Costs 10 Credits</div>
                  <input type="file" id="banner-file" accept="image/*" style="display:none;">
                </div>
              </div>
            </div>
            
            <div class="profile-section">
              <div class="section-header">
                <div class="section-icon">✏️</div>
                <h3 class="section-title">Basic Information</h3>
              </div>
              <div class="form-grid">
                <div class="enhanced-field">
                  <label for="display_name">Display Name</label>
                  <input type="text" id="display_name" name="display_name" placeholder="Your display name">
                </div>
                <div class="enhanced-field">
                  <label for="username">Username</label>
                  <input type="text" id="username" name="username" placeholder="Your username" readonly>
                </div>
              </div>
              <div class="form-grid single">
                <div class="enhanced-field">
                  <label for="bio">Bio</label>
                  <textarea id="bio" name="bio" rows="3" maxlength="200" placeholder="Tell us about yourself..."></textarea>
                </div>
                <div class="enhanced-field">
                  <label for="pronouns">Pronouns</label>
                  <input type="text" id="pronouns" name="pronouns" placeholder="e.g. she/her, they/them">
                </div>
              </div>
            </div>
            
            <button type="submit" class="btn-primary">Save Profile</button>
            <div id="profile-message"></div>
          </form>
        </div>
      </div>
      <div id="account-container" class="main-card tab-content" data-tab="account" style="display:none;">
        <div class="main-header">
          <span class="main-avatar" id="main-avatar-settings2"></span>
          <div>
            <h2>Account</h2>
          </div>
        </div>
        <form id="account-form">
          <section class="section-block">
            <h3 class="section-title">Contact & Account</h3>
            <div class="form-row">
              <div class="form-group enhanced-input">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" autocomplete="email">
                <span class="input-icon">📧</span>
              </div>
              <div class="form-group enhanced-input">
                <label for="discord_id">Discord ID</label>
                <input type="text" id="discord_id" name="discord_id" placeholder="Discord ID">
                <span class="input-icon">💬</span>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group enhanced-input">
                <label for="birthday">Birthday</label>
                <input type="text" id="birthday" name="birthday" placeholder="Birthday">
                <span class="input-icon">🎂</span>
              </div>
              <div class="form-group enhanced-input">
                <label for="nationality">Nationality</label>
                <input type="text" id="nationality" name="nationality" placeholder="Nationality">
                <span class="input-icon">🌍</span>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group enhanced-input">
                <label for="language">Language</label>
                <input type="text" id="language" name="language" placeholder="Language">
                <span class="input-icon">🗣️</span>
              </div>
              <div class="form-group">
                <label for="private">Private Account</label>
                <input type="checkbox" id="private" name="private">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group enhanced-input">
                <label for="password">Change Password</label>
                <input type="password" id="password" name="password" placeholder="New password (leave blank to keep current)">
                <span class="input-icon">🔒</span>
              </div>
            </div>
          </section>
          <button type="submit" class="btn-primary">Save Account</button>
          <div id="account-message"></div>
        </form>
      </div>
      <div id="friends-container" class="main-card tab-content" data-tab="friends" style="display:none;">
        <div class="main-header">
          <span class="main-avatar" id="main-avatar-friends"></span>
          <div>
            <h2>Friends & Connections</h2>
            <div class="main-system">Manage your friends and friend requests</div>
          </div>
        </div>
        
        <div class="friends-page-section">
          <div class="section-header">
            <div class="section-icon">👥</div>
            <h3 class="section-title">Your Friends</h3>
          </div>
          <div class="friends-grid" id="friends-page-list">
            <!-- Friends will be populated here -->
          </div>
        </div>
        
        <div class="friends-page-section">
          <div class="section-header">
            <div class="section-icon">📨</div>
            <h3 class="section-title">Friend Requests</h3>
          </div>
          <div class="friends-grid" id="friend-requests-page">
            <!-- Friend requests will be populated here -->
          </div>
        </div>
      </div>
      
      <div id="privacy-container" class="main-card tab-content" data-tab="privacy" style="display:none;">
        <div class="main-header">
          <span class="main-avatar" id="main-avatar-settings4"></span>
          <div>
            <h2>Privacy</h2>
          </div>
        </div>
        <form id="privacy-form">
          <section class="section-block">
            <h3 class="section-title">Privacy Settings</h3>
            <div class="form-row">
              <div class="form-group" style="flex:2;">
                <label for="private2">Private Account?</label>
                <input type="checkbox" id="private2" name="private" style="width:24px;height:24px;vertical-align:middle;">
              </div>
            </div>
            <div style="margin:24px 0 8px 0;font-weight:600;color:#1a73e8;background:#e8f0fe;padding:12px 16px;border-radius:8px;border:1px solid #c3d3f7;">Public Data:</div>
            <div class="privacy-public-list">
              <div class="privacy-public-item">Username</div>
              <div class="privacy-public-item">Profile Picture</div>
              <div class="privacy-public-item">Banner</div>
              <div class="privacy-public-item">Bio</div>
              <div class="privacy-public-item">Theming And Colours</div>
              <div class="privacy-public-item">Rotur Credit Total</div>
              <div class="privacy-public-item">Your Rotur Operating System</div>
              <div class="privacy-public-item">Account Creation Date</div>
            </div>
          </section>
          <button type="submit" class="btn-primary">Save Privacy</button>
          <div id="privacy-message"></div>
        </form>
      </div>
      <div id="transactions-container" class="main-card tab-content" data-tab="transactions" style="display:none;">
        <div class="main-header">
          <span class="main-avatar" id="main-avatar-settings4"></span>
          <div>
            <h2>Transaction History</h2>
            <div class="main-system">View your credit transactions and account activity</div>
          </div>
        </div>
        
        <div class="profile-section">
          <div class="section-header">
            <div class="section-icon">💳</div>
            <h3 class="section-title">Recent Transactions</h3>
          </div>
          <div id="transactions-list">
            <!-- Real transactions will be populated here from sys.transactions -->
          </div>
        </div>
      </div>
      
      <div id="about-container" class="main-card tab-content" data-tab="about" style="display:none;">
        <div class="main-header">
          <span class="main-avatar" id="main-avatar-settings5"></span>
          <div>
            <h2>About</h2>
          </div>
        </div>
        <div class="subtitle">Learn more about Rotur and this dashboard.</div>
        <div style="color:#5f6368; font-size:15px; margin-top:12px;">Rotur Account Dashboard v2.0<br>Made with ❤️ by Rotur.</div>
      </div>
    </main>
  </div>

  <script>
    function acceptFriend(name) {
      alert(`Friend request from ${name} accepted!`);
      // Here you would make an API call to accept the friend request
    }
    
    function updateDataUsage(user) {
      const maxSize = (user['max_size'] || 1000000000) / 1000000; // Default 1TB in MB
      const usedSize = (user['used_size'] || 0) / 1000000;
      const percentage = Math.min((usedSize / maxSize) * 100, 100);
      
      // Show in MB if under 1000MB, otherwise GB
      const usedDisplay = usedSize < 1000 ? `${usedSize.toFixed(1)} MB` : `${(usedSize / 1000).toFixed(1)} GB`;
      const maxDisplay = maxSize < 1000 ? `${maxSize.toFixed(1)} MB` : `${(maxSize / 1000).toFixed(1)} GB`;

      document.getElementById('data-usage-text').textContent = `${usedDisplay} / ${maxDisplay}`;
      document.getElementById('data-usage-bar').style.width = `${percentage}%`;
    }
    
    function updateProfileStats(user) {
      document.getElementById('stat-friends').textContent = user['sys.friends'] ? user['sys.friends'].length : 0;
      document.getElementById('stat-credits').textContent = user['sys.currency'] || 0;
      document.getElementById('stat-system').textContent = user.system || 'None';
      
      document.getElementById('profile-display-name').textContent = user.display_name || user.name || 'Your Name';
      document.getElementById('profile-username-display').textContent = '@' + (user.username || 'username');
      document.getElementById('profile-avatar-large').style.backgroundImage = user.pfp ? `url('${user.pfp}')` : '';
    }
    
    function formatTransactionTime(timestamp) {
      const date = new Date(timestamp);
      const now = new Date();
      const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));
      
      if (diffDays === 0) {
        return `Today, ${date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}`;
      } else if (diffDays === 1) {
        return `Yesterday, ${date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}`;
      } else if (diffDays < 7) {
        return `${diffDays} days ago, ${date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}`;
      } else {
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      }
    }
    
    function getTransactionIcon(type) {
      switch(type) {
        case 'in': return '+';
        case 'out': return '-';
        case 'tax': return '💰';
        default: return '•';
      }
    }
    
    function getTransactionTitle(transaction) {
      switch(transaction.type) {
        case 'in': 
          return transaction.note || `Credit from ${transaction.user}`;
        case 'out': 
          return transaction.note || `Payment to ${transaction.user}`;
        case 'tax': 
          return transaction.note || `Tax from ${transaction.user}`;
        default: 
          return transaction.note || 'Transaction';
      }
    }
    
    function populateTransactions(user) {
      const transactionsList = document.getElementById('transactions-list');
      
      if (user['sys.transactions'] && user['sys.transactions'].length > 0) {
        // Sort transactions by time (newest first)
        const sortedTransactions = user['sys.transactions']
          .sort((a, b) => b.time - a.time)
          .slice(0, 20); // Show only the 20 most recent transactions
        
        transactionsList.innerHTML = sortedTransactions.map(transaction => {
          const isCredit = transaction.type === 'in' || transaction.type === 'tax';
          const iconClass = isCredit ? 'credit' : 'debit';
          const amountClass = isCredit ? 'credit' : 'debit';
          const amountPrefix = isCredit ? '+' : '-';
          
          return `
            <div class="transaction-item">
              <div class="transaction-icon ${iconClass}">${getTransactionIcon(transaction.type)}</div>
              <div class="transaction-details">
                <div class="transaction-title">${getTransactionTitle(transaction)}</div>
                <div class="transaction-date">${formatTransactionTime(transaction.time)}</div>
              </div>
              <div class="transaction-amount ${amountClass}">${amountPrefix}${transaction.amount} ₹</div>
            </div>
          `;
        }).join('');
      } else {
        transactionsList.innerHTML = '<div style="padding: 16px; color: #5f6368; text-align: center;">No transactions yet</div>';
      }
    }
    
    function populateFriendsPage(user) {
      const friendsPageList = document.getElementById('friends-page-list');
      const requestsPageList = document.getElementById('friend-requests-page');
      
      // Populate friends grid
      if (user['sys.friends'] && user['sys.friends'].length > 0) {
        friendsPageList.innerHTML = user['sys.friends'].map(friendUsername => `
          <div class="friend-card">
            <div class="friend-card-avatar" style="background-image: url('https://avatars.rotur.dev/${friendUsername}');"></div>
            <div class="friend-card-name">${friendUsername}</div>
          </div>
        `).join('');
      } else {
        friendsPageList.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: #5f6368; padding: 32px;">No friends yet. Start connecting with others!</div>';
      }
      
      // Populate friend requests grid
      if (user['sys.requests'] && user['sys.requests'].length > 0) {
        requestsPageList.innerHTML = user['sys.requests'].map(requestUsername => `
          <div class="friend-card friend-request-card">
            <div class="friend-card-avatar" style="background-image: url('https://avatars.rotur.dev/${requestUsername}');"></div>
            <div class="friend-card-name">${requestUsername}</div>
            <div class="friend-card-status">Wants to be friends</div>
            <button class="accept-friend-btn" onclick="acceptFriend('${requestUsername}')">Accept Request</button>
          </div>
        `).join('');
      } else {
        requestsPageList.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: #5f6368; padding: 32px;">No pending friend requests</div>';
      }
    }

    // Get token from URL or localStorage
    function getToken() {
      const urlParams = new URLSearchParams(window.location.search);
      let token = urlParams.get('token');
      if (token) {
        localStorage.setItem('rotur_token', token);
        window.history.replaceState({}, document.title, window.location.pathname);
      } else {
        token = localStorage.getItem('rotur_token');
      }
      return token;
    }

    // Tab navigation logic
    function showTab(tab) {
      document.querySelectorAll('.tab-content').forEach(el => {
        el.classList.remove('active');
        el.style.display = 'none';
      });
      const tabEl = document.querySelector(`.tab-content[data-tab="${tab}"]`);
      if (tabEl) {
        tabEl.classList.add('active');
        tabEl.style.display = 'block';
      }
      document.querySelectorAll('#sidebar-tabs li').forEach(li => {
        li.classList.remove('active');
        if (li.dataset.tab === tab) li.classList.add('active');
      });
    }

    // File upload handlers
    function setupFileUpload(fileInputId, previewId) {
      const fileInput = document.getElementById(fileInputId);
      const preview = document.getElementById(previewId);
      
      fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            preview.src = e.target.result;
            preview.style.display = 'block';
          };
          reader.readAsDataURL(file);
        }
      });
    }

    // Sidebar tab click events
    document.querySelectorAll('#sidebar-tabs li').forEach(li => {
      li.onclick = function() {
        showTab(this.dataset.tab);
      };
    });

    // Authenticate button
    document.getElementById('auth-btn').onclick = function() {
      window.location.href = 'https://rotur.dev/auth?return_to=' + encodeURIComponent(window.location.href);
    };

    // On load, check for token and load user info
    window.onload = async function() {
      setupFileUpload('pfp-file', 'pfp-preview');
      setupFileUpload('banner-file', 'banner-preview');
      
      const token = getToken();
      if (!token) {
        showTab('auth');
        document.getElementById('auth-container').style.display = 'block';
        document.getElementById('token-warning').style.display = 'block';
        return;
      }
      showTab('profile');
      // Fetch user info
      try {
        const res = await fetch('https://social.rotur.dev/get_user?auth=' + token);
        const user = await res.json();
        if (user.error) {
          showTab('auth');
          document.getElementById('auth-container').style.display = 'block';
          document.getElementById('token-warning').textContent = user.error;
          document.getElementById('token-warning').style.display = 'block';
          return;
        }
        
        // Update data usage and profile stats
        updateDataUsage(user);
        updateProfileStats(user);
        // Populate real transaction data
        populateTransactions(user);
        // Populate friends page
        populateFriendsPage(user);
        
        // Sidebar avatar, name
        document.getElementById('sidebar-avatar').style.backgroundImage = user.pfp ? `url('${user.pfp}')` : '';
        document.getElementById('sidebar-name').textContent = user.name || user.username || '';
        document.getElementById('sidebar-system').textContent = user.system ? `System: ${user.system}` : '';
        document.getElementById('sidebar-currency').textContent = `${user['sys.currency'] || 0} Credits`;
        
        // Set avatars for all settings tabs
        ['main-avatar-settings2', 'main-avatar-settings3', 'main-avatar-settings4', 'main-avatar-settings5', 'main-avatar-friends'].forEach(id => {
          const el = document.getElementById(id);
          if (el) el.style.backgroundImage = user.pfp ? `url('${user.pfp}')` : '';
        });
        
        // Fill form fields
        document.getElementById('display_name').value = user.display_name || '';
        document.getElementById('username').value = user.username || '';
        document.getElementById('bio').value = user.bio || '';
        document.getElementById('pronouns').value = user.pronouns || '';
        // Account section
        document.getElementById('email').value = user.email || '';
        document.getElementById('discord_id').value = user.discord_id || '';
        document.getElementById('birthday').value = user.birthday || '';
        document.getElementById('nationality').value = user.nationality || '';
        document.getElementById('language').value = user.language || '';
        // Privacy toggle
        document.getElementById('private').checked = !!user.private;
        document.getElementById('private2').checked = !!user.private;
        // Previews
        if (user.pfp) {
          document.getElementById('pfp-preview').src = user.pfp;
          document.getElementById('pfp-preview').style.display = 'block';
          document.getElementById('pfp-preview').parentElement.classList.add('has-image');
        }
        if (user.banner) {
          document.getElementById('banner-preview').src = user.banner;
          document.getElementById('banner-preview').style.display = 'block';
          document.getElementById('banner-preview').parentElement.classList.add('has-image');
        }
      } catch (err) {
        document.getElementById('profile-message').innerHTML = '<div class="error-message">Could not load user info.</div>';
      }
    };

    // Save changes - Profile form
    document.getElementById('profile-form').onsubmit = async function(e) {
      e.preventDefault();
      const token = getToken();
      if (!token) {
        showTab('auth');
        return;
      }
      
      // Handle file uploads
      const pfpFile = document.getElementById('pfp-file').files[0];
      const bannerFile = document.getElementById('banner-file').files[0];
      
      let pfpUrl = '';
      let bannerUrl = '';
      
      // Upload files if selected (you'd need to implement file upload API)
      if (pfpFile) {
        // This would upload to your server and return URL
        // pfpUrl = await uploadFile(pfpFile);
      }
      if (bannerFile) {
        // bannerUrl = await uploadFile(bannerFile);
      }
      
      const fields = [
        { key: 'display_name', value: document.getElementById('display_name').value.trim() },
        { key: 'bio', value: document.getElementById('bio').value.trim() },
        { key: 'pronouns', value: document.getElementById('pronouns').value.trim() },
      ];
      
      if (pfpUrl) fields.push({ key: 'pfp', value: pfpUrl });
      if (bannerUrl) fields.push({ key: 'banner', value: bannerUrl });
      
      let errors = [];
      let successes = [];
      
      for (const field of fields) {
        try {
          const res = await fetch('https://social.rotur.dev/users', {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ key: field.key, value: field.value, auth: token })
          });
          const result = await res.json();
          if (result.error) {
            errors.push(`${field.key}: ${result.error}`);
          } else {
            successes.push(field.key);
          }
        } catch (err) {
          errors.push(`${field.key}: Network error`);
        }
      }
      
      if (errors.length > 0) {
        document.getElementById('profile-message').innerHTML = '<div class="error-message">' + errors.join('<br>') + '</div>';
      } else if (successes.length > 0) {
        document.getElementById('profile-message').innerHTML = '<div class="success-message">Updated: ' + successes.join(', ') + '</div>';
      }
    };
    
    // Account form
    document.getElementById('account-form').onsubmit = async function(e) {
      e.preventDefault();
      const token = getToken();
      if (!token) {
        showTab('auth');
        return;
      }
      const fields = [
        { key: 'email', value: document.getElementById('email').value.trim() },
        { key: 'discord_id', value: document.getElementById('discord_id').value.trim() },
        { key: 'birthday', value: document.getElementById('birthday').value.trim() },
        { key: 'nationality', value: document.getElementById('nationality').value.trim() },
        { key: 'language', value: document.getElementById('language').value.trim() },
        { key: 'private', value: document.getElementById('private').checked },
      ];
      const password = document.getElementById('password').value;
      if (password) {
        fields.push({ key: 'password', value: password });
      }
      
      let errors = [];
      let successes = [];
      
      for (const field of fields) {
        try {
          const res = await fetch('https://social.rotur.dev/users', {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ key: field.key, value: field.value, auth: token })
          });
          const result = await res.json();
          if (result.error) {
            errors.push(`${field.key}: ${result.error}`);
          } else {
            successes.push(field.key);
          }
        } catch (err) {
          errors.push(`${field.key}: Network error`);
        }
      }
      
      if (errors.length > 0) {
        document.getElementById('account-message').innerHTML = '<div class="error-message">' + errors.join('<br>') + '</div>';
      } else if (successes.length > 0) {
        document.getElementById('account-message').innerHTML = '<div class="success-message">Updated: ' + successes.join(', ') + '</div>';
        if (password) {
          document.getElementById('password').value = '';
        }
      }
    };
    
    // Privacy form
    document.getElementById('privacy-form').onsubmit = async function(e) {
      e.preventDefault();
      const token = getToken();
      if (!token) {
        showTab('auth');
        return;
      }
      const fields = [
        { key: 'private', value: document.getElementById('private2').checked },
      ];
      
      let errors = [];
      let successes = [];
      
      for (const field of fields) {
        try {
          const res = await fetch('https://social.rotur.dev/users', {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ key: field.key, value: field.value, auth: token })
          });
          const result = await res.json();
          if (result.error) {
            errors.push(`${field.key}: ${result.error}`);
          } else {
            successes.push(field.key);
          }
        } catch (err) {
          errors.push(`${field.key}: Network error`);
        }
      }
      
      if (errors.length > 0) {
        document.getElementById('privacy-message').innerHTML = '<div class="error-message">' + errors.join('<br>') + '</div>';
      } else if (successes.length > 0) {
        document.getElementById('privacy-message').innerHTML = '<div class="success-message">Updated: ' + successes.join(', ') + '</div>';
      }
    };
  </script>
</body>
</html>
